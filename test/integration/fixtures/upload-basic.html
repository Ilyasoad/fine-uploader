<!DOCTYPE html>
<html>
    <head>
        <title> Integration Test Suite :: FineUploader</title>
        <meta http-equiv='Content-Type' content='text/html' charset='utf-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1.0'>

    </head>

    <body>
        <div id="mocha"></div>
        <div id="fine-uploader"></div>

        <script src="/static/client.js" type="text/javascript"></script>
        <script src="/_vendor/jquery/jquery.js" type="text/javascript"></script>
        <script src="/_vendor/sinon-1.7.3/index.js" type="text/javascript"></script>
        <link href="/_vendor/mocha/css/mocha.css" type="text/css"></script>
        <script src="/_vendor/mocha/js/mocha.js" type="text/javascript"></script>
        <script src="/_vendor/json2/json2.js" type="text/javascript"></script>

        <script>
          window.chocoReady = false;
          window.mochaResults = {};
          mocha.setup('bdd');
        </script>

        <!-- Fine Uploader -->
        <link href="/_temp/fineuploader.css" />
        <script src="/_temp/jquery.fineuploader.js" type="text/javascript"></script>

        <script>
            $(document).ready(function () {
                "use strict";
                $('#fine-uploader').fineUploader({
                    debug: true,
                    autoUpload: false,
                    request: {
                        endpoint: "/upload"
                    },
                    chunking: {
                        enabled: true
                    },
                    resume: {
                        enabled: true
                    },
                    retry: {
                        enableAuto: false,
                        showButton: true
                    },
                    deleteFile: {
                        enabled: true,
                        endpoint: '/upload',
                        forceConfirm: true,
                        params: {
                            foo: "bar"
                        }
                    },
                    display: {
                        fileSizeOnSubmit: true
                    },
                    paste: {
                        targetElement: $(document)
                    }
                });
            });

            describe("Upload Basic", function () {
                "use strict";
                before(function () {
                    this.server = sinon.fakeServer.create();
                });

                after(function () {
                    this.server.restore();
                });

                it("should upload to the server", function () {
                    this.server.respondWith("POST", "/upload", [200, {
                        "Content-type": "application/json"
                    },
                        JSON.stringify({
                            success: true
                        })
                    ]);

                    $("#fine-uploader").on('submitted', function (id, name) {
                        assert.ok(true);
                        assert.equal(id, 0);
                    });
                });
            });

            mochaSaucePlease();
        </script>

    </body>
</html>